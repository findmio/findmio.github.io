<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AutoX.js 获取手机截图上传至 OSS | MIO'S BLOG</title>
<meta name=keywords content="autox.js,rpa,阿里云"><meta name=description content='前言 AutoX.js 使用的是 Rhino 作为 JavaScript 引擎，并不支持完整的 nodejs 模块，所以没法直接调用 nodejs 下的 OSS 包。
下面展示使用 OSS Android SDK 完成上传的过程
准备工作 前往 OSS Android SDK，下载依赖包
将 aar 格式的 SDK 转换为 dex
这里使用 Android Studio 提供的工具 d8，进入到 Android Studio 安装目录下，d8 一般在 build-tools 下，MacOS 下为 ~/Library/Android/sdk/build-tools/{version}/
./d8 --release --output output_folder oss-android-sdk-2.9.13.aar 会生成一个 classes.dex 的文件
拷贝 classes.dex 到手机 截图 // 安卓版本高于 Android 9，需要手动确认授权 if (device.sdkInt > 28) { // 等待截屏权限申请并同意 threads.start(function () { // 这里的系统提示框可能不是运行，改成对应文本即可 packageName("com.'><meta name=author content="findmio"><link rel=canonical href=https://findmio.github.io/post/rpa/autox.js-%E8%8E%B7%E5%8F%96%E6%89%8B%E6%9C%BA%E6%88%AA%E5%9B%BE%E4%B8%8A%E4%BC%A0%E8%87%B3-oss/><link crossorigin=anonymous href=/assets/css/stylesheet.min.bc602cdf1592fdcc04226732c7c099ca280a0da9d214120b0e45b0439f45a111.css integrity="sha256-vGAs3xWS/cwEImcyx8CZyigKDanSFBILDkWwQ59FoRE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://findmio.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://findmio.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://findmio.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://findmio.github.io/apple-touch-icon.png><link rel=mask-icon href=https://findmio.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://findmio.github.io/post/rpa/autox.js-%E8%8E%B7%E5%8F%96%E6%89%8B%E6%9C%BA%E6%88%AA%E5%9B%BE%E4%B8%8A%E4%BC%A0%E8%87%B3-oss/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="AutoX.js 获取手机截图上传至 OSS"><meta property="og:description" content='前言 AutoX.js 使用的是 Rhino 作为 JavaScript 引擎，并不支持完整的 nodejs 模块，所以没法直接调用 nodejs 下的 OSS 包。
下面展示使用 OSS Android SDK 完成上传的过程
准备工作 前往 OSS Android SDK，下载依赖包
将 aar 格式的 SDK 转换为 dex
这里使用 Android Studio 提供的工具 d8，进入到 Android Studio 安装目录下，d8 一般在 build-tools 下，MacOS 下为 ~/Library/Android/sdk/build-tools/{version}/
./d8 --release --output output_folder oss-android-sdk-2.9.13.aar 会生成一个 classes.dex 的文件
拷贝 classes.dex 到手机 截图 // 安卓版本高于 Android 9，需要手动确认授权 if (device.sdkInt > 28) { // 等待截屏权限申请并同意 threads.start(function () { // 这里的系统提示框可能不是运行，改成对应文本即可 packageName("com.'><meta property="og:type" content="article"><meta property="og:url" content="https://findmio.github.io/post/rpa/autox.js-%E8%8E%B7%E5%8F%96%E6%89%8B%E6%9C%BA%E6%88%AA%E5%9B%BE%E4%B8%8A%E4%BC%A0%E8%87%B3-oss/"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-04-15T19:21:55+08:00"><meta property="article:modified_time" content="2024-04-15T19:21:55+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="AutoX.js 获取手机截图上传至 OSS"><meta name=twitter:description content='前言 AutoX.js 使用的是 Rhino 作为 JavaScript 引擎，并不支持完整的 nodejs 模块，所以没法直接调用 nodejs 下的 OSS 包。
下面展示使用 OSS Android SDK 完成上传的过程
准备工作 前往 OSS Android SDK，下载依赖包
将 aar 格式的 SDK 转换为 dex
这里使用 Android Studio 提供的工具 d8，进入到 Android Studio 安装目录下，d8 一般在 build-tools 下，MacOS 下为 ~/Library/Android/sdk/build-tools/{version}/
./d8 --release --output output_folder oss-android-sdk-2.9.13.aar 会生成一个 classes.dex 的文件
拷贝 classes.dex 到手机 截图 // 安卓版本高于 Android 9，需要手动确认授权 if (device.sdkInt > 28) { // 等待截屏权限申请并同意 threads.start(function () { // 这里的系统提示框可能不是运行，改成对应文本即可 packageName("com.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://findmio.github.io/post/"},{"@type":"ListItem","position":2,"name":"AutoX.js 获取手机截图上传至 OSS","item":"https://findmio.github.io/post/rpa/autox.js-%E8%8E%B7%E5%8F%96%E6%89%8B%E6%9C%BA%E6%88%AA%E5%9B%BE%E4%B8%8A%E4%BC%A0%E8%87%B3-oss/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AutoX.js 获取手机截图上传至 OSS","name":"AutoX.js 获取手机截图上传至 OSS","description":"前言 AutoX.js 使用的是 Rhino 作为 JavaScript 引擎，并不支持完整的 nodejs 模块，所以没法直接调用 nodejs 下的 OSS 包。\n下面展示使用 OSS Android SDK 完成上传的过程\n准备工作 前往 OSS Android SDK，下载依赖包\n将 aar 格式的 SDK 转换为 dex\n这里使用 Android Studio 提供的工具 d8，进入到 Android Studio 安装目录下，d8 一般在 build-tools 下，MacOS 下为 ~/Library/Android/sdk/build-tools/{version}/\n./d8 --release --output output_folder oss-android-sdk-2.9.13.aar 会生成一个 classes.dex 的文件\n拷贝 classes.dex 到手机 截图 // 安卓版本高于 Android 9，需要手动确认授权 if (device.sdkInt \u0026gt; 28) { // 等待截屏权限申请并同意 threads.start(function () { // 这里的系统提示框可能不是运行，改成对应文本即可 packageName(\u0026#34;com.","keywords":["autox.js","rpa","阿里云"],"articleBody":"前言 AutoX.js 使用的是 Rhino 作为 JavaScript 引擎，并不支持完整的 nodejs 模块，所以没法直接调用 nodejs 下的 OSS 包。\n下面展示使用 OSS Android SDK 完成上传的过程\n准备工作 前往 OSS Android SDK，下载依赖包\n将 aar 格式的 SDK 转换为 dex\n这里使用 Android Studio 提供的工具 d8，进入到 Android Studio 安装目录下，d8 一般在 build-tools 下，MacOS 下为 ~/Library/Android/sdk/build-tools/{version}/\n./d8 --release --output output_folder oss-android-sdk-2.9.13.aar 会生成一个 classes.dex 的文件\n拷贝 classes.dex 到手机 截图 // 安卓版本高于 Android 9，需要手动确认授权 if (device.sdkInt \u003e 28) { // 等待截屏权限申请并同意 threads.start(function () { // 这里的系统提示框可能不是运行，改成对应文本即可 packageName(\"com.android.systemui\").text(\"运行\").waitFor(); text(\"运行\").click(); }); } // 申请截屏权限，false 竖屏 if (!requestScreenCapture(false)) { console.error(\"请求截图失败\"); exit(); } // 获取到截图 var image = images.captureScreen(); 上传 这里使用了字节数组的方式上传，也可以保存到本地，再上传\n// 使用绝对路径导入 SDK var dexPath = files.path(\"/storage/emulated/0/Download/classes.dex\"); runtime.loadDex(dexPath); // 导入 OSS 中的类 importClass(com.alibaba.sdk.android.oss.ClientConfiguration); importClass(com.alibaba.sdk.android.oss.ClientException); importClass(com.alibaba.sdk.android.oss.OSS); importClass(com.alibaba.sdk.android.oss.OSSClient); importClass(com.alibaba.sdk.android.oss.ServiceException); importClass(com.alibaba.sdk.android.oss.common.auth.OSSCredentialProvider); importClass( com.alibaba.sdk.android.oss.common.auth.OSSStsTokenCredentialProvider ); importClass(com.alibaba.sdk.android.oss.model.PutObjectRequest); importClass(com.alibaba.sdk.android.oss.model.PutObjectResult); // 下面的参数是在阿里云生成 var OSS_ENDPOINT = \"yourEndpoint\"; var OSS_ACCESS_KEY_ID = \"yourAccessKeyId\"; var OSS_ACCESS_KEY_SECRET = \"yourAccessKeySecret\"; var bucketName = \"yourBucket\"; var credentialProvider = new OSSStsTokenCredentialProvider( OSS_ACCESS_KEY_ID, OSS_ACCESS_KEY_SECRET, \"\" ); // OSSClient 的配置类 var conf = new ClientConfiguration(); conf.setConnectionTimeout(60000); // 建立连接的超时时间，单位为毫秒。默认为60000毫秒 conf.setSocketTimeout(60000); // Socket层传输数据的超时时间，单位为毫秒。默认为60000毫秒 conf.setMaxConcurrentRequest(5); // 最大并发数。默认为5 conf.setMaxErrorRetry(2); // 请求失败后最大的重试次数。默认2次 var oss = new OSSClient(context, OSS_ENDPOINT, credentialProvider, conf); // 文件名 var filename = \"screenshot.jpg\"; // 使用字节数组上传 var imageBytes = images.toBytes(image, \"jpg\", 100); var put = new PutObjectRequest(bucketName, filename, imageBytes); putResult = oss.putObject(put); // 上传后的链接 var ossUrl = `https://${bucketName}.${OSS_ENDPOINT}/${filename}`; // 上传成功 if (putResult.getStatusCode() === 200) { console.log(ossUrl); } 参考链接 AutoX.js v6.5.9 aliyun-oss-sdk-android-2.9.13.aar OSSClent 配置 OSS 创建 AccessKey ","wordCount":"217","inLanguage":"zh","datePublished":"2024-04-15T19:21:55+08:00","dateModified":"2024-04-15T19:21:55+08:00","author":{"@type":"Person","name":"findmio"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://findmio.github.io/post/rpa/autox.js-%E8%8E%B7%E5%8F%96%E6%89%8B%E6%9C%BA%E6%88%AA%E5%9B%BE%E4%B8%8A%E4%BC%A0%E8%87%B3-oss/"},"publisher":{"@type":"Organization","name":"MIO'S BLOG","logo":{"@type":"ImageObject","url":"https://findmio.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://findmio.github.io/ accesskey=h title="MIO'S BLOG (Alt + H)">MIO'S BLOG</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://findmio.github.io/archives title=归档><span>归档</span></a></li><li><a href=https://findmio.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://findmio.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://findmio.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>AutoX.js 获取手机截图上传至 OSS</h1><div class=post-meta><span title='2024-04-15 19:21:55 +0800 +0800'>2024-04-15</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c aria-label=准备工作>准备工作</a></li><li><a href=#%e6%88%aa%e5%9b%be aria-label=截图>截图</a></li><li><a href=#%e4%b8%8a%e4%bc%a0 aria-label=上传>上传</a></li><li><a href=#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5 aria-label=参考链接>参考链接</a></li></ul></div></details></div><div class=post-content><h2 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2><p><a href=https://github.com/kkevsekk1/AutoX>AutoX.js</a> 使用的是 <a href=https://github.com/mozilla/rhino>Rhino</a> 作为 <code>JavaScript</code> 引擎，并不支持完整的 <code>nodejs</code> 模块，所以没法直接调用 <code>nodejs</code> 下的 <a href=https://www.npmjs.com/package/oss>OSS</a> 包。</p><p>下面展示使用 <a href=https://help.aliyun.com/zh/oss/developer-reference/installation-1>OSS Android SDK</a> 完成上传的过程</p><h2 id=准备工作>准备工作<a hidden class=anchor aria-hidden=true href=#准备工作>#</a></h2><ol><li><p>前往 <a href=https://help.aliyun.com/zh/oss/developer-reference/installation-1>OSS Android SDK</a>，下载依赖包</p></li><li><p>将 <code>aar</code> 格式的 <code>SDK</code> 转换为 <code>dex</code></p></li></ol><p>这里使用 Android Studio 提供的工具 <code>d8</code>，进入到 Android Studio 安装目录下，<code>d8</code> 一般在 <code>build-tools</code> 下，<code>MacOS</code> 下为 <code>~/Library/Android/sdk/build-tools/{version}/</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./d8 --release --output output_folder oss-android-sdk-2.9.13.aar
</span></span></code></pre></div><p>会生成一个 <code>classes.dex</code> 的文件</p><ol start=3><li>拷贝 <code>classes.dex</code> 到手机</li></ol><h2 id=截图>截图<a hidden class=anchor aria-hidden=true href=#截图>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 安卓版本高于 Android 9，需要手动确认授权
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>device</span><span class=p>.</span><span class=nx>sdkInt</span> <span class=o>&gt;</span> <span class=mi>28</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 等待截屏权限申请并同意
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>threads</span><span class=p>.</span><span class=nx>start</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 这里的系统提示框可能不是运行，改成对应文本即可
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>packageName</span><span class=p>(</span><span class=s2>&#34;com.android.systemui&#34;</span><span class=p>).</span><span class=nx>text</span><span class=p>(</span><span class=s2>&#34;运行&#34;</span><span class=p>).</span><span class=nx>waitFor</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>text</span><span class=p>(</span><span class=s2>&#34;运行&#34;</span><span class=p>).</span><span class=nx>click</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 申请截屏权限，false 竖屏
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>requestScreenCapture</span><span class=p>(</span><span class=kc>false</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s2>&#34;请求截图失败&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取到截图
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>image</span> <span class=o>=</span> <span class=nx>images</span><span class=p>.</span><span class=nx>captureScreen</span><span class=p>();</span>
</span></span></code></pre></div><h2 id=上传>上传<a hidden class=anchor aria-hidden=true href=#上传>#</a></h2><p>这里使用了字节数组的方式上传，也可以保存到本地，再上传</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 使用绝对路径导入 SDK
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>dexPath</span> <span class=o>=</span> <span class=nx>files</span><span class=p>.</span><span class=nx>path</span><span class=p>(</span><span class=s2>&#34;/storage/emulated/0/Download/classes.dex&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>runtime</span><span class=p>.</span><span class=nx>loadDex</span><span class=p>(</span><span class=nx>dexPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 导入 OSS 中的类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>ClientConfiguration</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>ClientException</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>OSS</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>OSSClient</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>ServiceException</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>common</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>OSSCredentialProvider</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>common</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>OSSStsTokenCredentialProvider</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>model</span><span class=p>.</span><span class=nx>PutObjectRequest</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importClass</span><span class=p>(</span><span class=nx>com</span><span class=p>.</span><span class=nx>alibaba</span><span class=p>.</span><span class=nx>sdk</span><span class=p>.</span><span class=nx>android</span><span class=p>.</span><span class=nx>oss</span><span class=p>.</span><span class=nx>model</span><span class=p>.</span><span class=nx>PutObjectResult</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 下面的参数是在阿里云生成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>OSS_ENDPOINT</span> <span class=o>=</span> <span class=s2>&#34;yourEndpoint&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>OSS_ACCESS_KEY_ID</span> <span class=o>=</span> <span class=s2>&#34;yourAccessKeyId&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>OSS_ACCESS_KEY_SECRET</span> <span class=o>=</span> <span class=s2>&#34;yourAccessKeySecret&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>bucketName</span> <span class=o>=</span> <span class=s2>&#34;yourBucket&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>credentialProvider</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OSSStsTokenCredentialProvider</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>OSS_ACCESS_KEY_ID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>OSS_ACCESS_KEY_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// OSSClient 的配置类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>conf</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ClientConfiguration</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>conf</span><span class=p>.</span><span class=nx>setConnectionTimeout</span><span class=p>(</span><span class=mi>60000</span><span class=p>);</span> <span class=c1>// 建立连接的超时时间，单位为毫秒。默认为60000毫秒
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>conf</span><span class=p>.</span><span class=nx>setSocketTimeout</span><span class=p>(</span><span class=mi>60000</span><span class=p>);</span> <span class=c1>// Socket层传输数据的超时时间，单位为毫秒。默认为60000毫秒
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>conf</span><span class=p>.</span><span class=nx>setMaxConcurrentRequest</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span> <span class=c1>// 最大并发数。默认为5
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>conf</span><span class=p>.</span><span class=nx>setMaxErrorRetry</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// 请求失败后最大的重试次数。默认2次
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>oss</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OSSClient</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span> <span class=nx>OSS_ENDPOINT</span><span class=p>,</span> <span class=nx>credentialProvider</span><span class=p>,</span> <span class=nx>conf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 文件名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>filename</span> <span class=o>=</span> <span class=s2>&#34;screenshot.jpg&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 使用字节数组上传
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>imageBytes</span> <span class=o>=</span> <span class=nx>images</span><span class=p>.</span><span class=nx>toBytes</span><span class=p>(</span><span class=nx>image</span><span class=p>,</span> <span class=s2>&#34;jpg&#34;</span><span class=p>,</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>put</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PutObjectRequest</span><span class=p>(</span><span class=nx>bucketName</span><span class=p>,</span> <span class=nx>filename</span><span class=p>,</span> <span class=nx>imageBytes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>putResult</span> <span class=o>=</span> <span class=nx>oss</span><span class=p>.</span><span class=nx>putObject</span><span class=p>(</span><span class=nx>put</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 上传后的链接
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>ossUrl</span> <span class=o>=</span> <span class=sb>`https://</span><span class=si>${</span><span class=nx>bucketName</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>OSS_ENDPOINT</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>filename</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 上传成功
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>putResult</span><span class=p>.</span><span class=nx>getStatusCode</span><span class=p>()</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>ossUrl</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=参考链接>参考链接<a hidden class=anchor aria-hidden=true href=#参考链接>#</a></h2><ul><li><a href=https://github.com/kkevsekk1/AutoX/releases/tag/6.5.9>AutoX.js v6.5.9</a></li><li><a href=https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20230420/jsol/oss-android-sdk-2.9.13.aar>aliyun-oss-sdk-android-2.9.13.aar</a></li><li><a href=https://help.aliyun.com/zh/oss/developer-reference/initialization-1#section-755-5xq-f9c>OSSClent 配置</a></li><li><a href=https://help.aliyun.com/document_detail/53045.html>OSS 创建 AccessKey</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://findmio.github.io/tags/autox.js/>Autox.js</a></li><li><a href=https://findmio.github.io/tags/rpa/>Rpa</a></li><li><a href=https://findmio.github.io/tags/%E9%98%BF%E9%87%8C%E4%BA%91/>阿里云</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://findmio.github.io/>MIO'S BLOG</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>